"use strict";angular.module("contantsListApp",["ngCookies","ngResource","ngSanitize","ui.router","contantsListDirectives","firebase","ngMessages","ngMaterial"]).constant("CONFIG",{Firebase:{host:"https://vivid-fire-1462.firebaseio.com/",secret:"GqX862HRsBGG1B7WzUOSpT3gUt0O3atmDqiJ3R2u",service:"ContactsListModel"},API:{host:"https://dummy.com/",service:"ContactsListModelAPI"},token:"thisisasecrettoken",activeModel:"Firebase",timeoutMessage:1e3}).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("main",{url:"/",views:{header:{templateUrl:"views/components/header.html"},"content@":{templateUrl:"views/contact/list.html",controller:"ContactListCtrl",controllerAs:"ListCtrl"}}}).state("main.details",{url:"contact/:id",views:{"content@":{templateUrl:"views/contact/details.html",controller:"ContactDetailsCtrl",controllerAs:"DetailsCtrl"}}}).state("main.add",{url:"contact",views:{"content@":{templateUrl:"views/contact/details.html",controller:"ContactDetailsCtrl",controllerAs:"DetailsCtrl"}}}),e.otherwise("/")}]),angular.module("contantsListApp").factory("alertService",["CONFIG","$rootScope","$timeout","$mdToast",function(t,e,n,r){var o={};return o.emit=function(t,n){e.$emit(t,n)},o.on=function(n){e.$on(n,function(e,n){r.show(r.simple().content(n).position("top right left").hideDelay(t.timeoutMessage))})},o.on("headerAlert"),o}]),angular.module("contantsListApp").controller("ContactListCtrl",["CONFIG","$injector","$rootScope","$scope",function(t,e,n,r){function o(t,e,n){var r=this;return r.$$scope=e,r.$$scope.pagerProgress=0,r.$$scopeList=n,r.currentPage=1,r.numPerPage=10,r.firstPage=1,r.lastPage=1,r.pager=function(e,n){r.currentPage=n?e:r.currentPage+e;var o=(r.currentPage-1)*r.numPerPage,a=o+r.numPerPage;r.$$scope[t]=r.$$scopeList.slice(o,a),r.$$scope.pagerProgress=r.currentPage/r.lastPage*100},r.update=function(){r.lastPage=0===r.$$scopeList.length?1:Math.ceil(r.$$scopeList.length/r.numPerPage)},r.pager(r.firstPage,!0),r.update(),{set:{list:function(t){r.$$scopeList=t,r.update()}},get:{list:function(){return r.$$scopeList}},firstPage:function(){return r.firstPage},lastPage:function(){return r.lastPage},currentPage:function(){return r.currentPage},next:function(){r.pager(1)},prev:function(){r.pager(-1)},first:function(){r.pager(r.firstPage,!0)},last:function(){r.pager(r.lastPage,!0)},page:function(t){return 1>t||t>r.lastPage?!1:void r.pager(t,!0)}}}var a=e.get(t[t.activeModel].service);r.loading=!0,r.contactsList=[],r.filteredContacts=[],a.get().then(function(t){r.loading=!1,r.contactsList="undefined"!=typeof t.$inst?t:t.data.contacts,r.pagination=new o("filteredContacts",r,r.contactsList)}),r.$watch("searchText",_.debounce(function(t,e,n){n.$apply(function(){if(0===n.contactsList.length)return!1;if(!t)return n.pagination.set.list(n.contactsList),n.pagination.first(),!0;var e,r=new RegExp(t,"gi");-1!==t.search(/^(([0-9]{0,4})(-)?){1,3}$/)?e=function(t){return-1!==t.phone.search(r)}:-1!==t.search(/^[a-z ,.'-]+$/i)&&(e=function(t){return-1!==t.name.search(r)}),n.pagination.set.list(_.filter(n.contactsList,e)),n.pagination.first()})},500),!0)}]),angular.module("contantsListApp").controller("ContactDetailsCtrl",["CONFIG","$injector","$scope","$rootScope","$stateParams","$state","$timeout","alertService",function(t,e,n,r,o,a,i,s){var c=this,l=e.get(t[t.activeModel].service);c.ID=o.id||!1,n.message=!1,n.contact={},c.get=function(t){l.get(t).then(function(t){n.contact="undefined"!=typeof t.$$conf?t:t.data},function(){n.contact={}})},c.save=function(t,e,n){return t?!1:void l.save(e,n).then(function(){c.message("Save successful")},function(t){c.message(t.message)})},c.delete=function(t){l.remove(t).then(function(){delete n.contact,c.message("Deleted Successfully"),a.go("main")},function(t){c.message(t.message)})},c.message=function(t){s.emit("headerAlert",t)},c.get(c.ID)}]),function(){angular.module("formHelpers",[]).filter("text",function(){return{alphabetic:function(t){return t.replace(/\W+/g,"")}}});var t=angular.module("contantsListDirectives",["formHelpers","ngMessages"]);t.controller("formInputController",function(){}),angular.forEach({text:"inputText",tel:"inputTel",textarea:"inputTextarea"},function(e,n){t.directive(e,["textFilter",function(t){return{controller:"formInputController",controllerAs:"inputCtrl",templateUrl:"views/forms/components/"+n+".html",restrict:"E",require:"^form",required:["ngModel","label"],scope:{label:"@",ngModel:"="},link:function(e,r,o,a){e.type=n,e.labelClean=t.alphabetic(e.label).toLowerCase(),e.form=a}}}])})}(),angular.module("contantsListApp").factory("ContactsListModelAPI",["CONFIG","$http","$q",function(t,e,n){var r=t.API.host+"contacts",o=function(t){return t?e.get(r,{id:t}):e.get(r)},a=["name","phone"],i=function(t,o){for(var i in a)if("undefined"==typeof t[a[i]])return n.reject({status:!1,message:"Required "+[a[i]]});return o?e.post(r,{data:t,id:o}):e.post(r,t)},s=function(t,n){return e.delete(r,{id:n})};return{get:o,save:i,remove:s}}]),angular.module("contantsListApp").factory("ContactsListModel",["CONFIG","Firebase","$firebase",function(t,e,n){var r,o=new e(t.Firebase.host+"contacts"),a=n(o),i=[],s=function(t){if(t){if(0===i.length){var e=n(o.child(t));r=e.$asObject()}return r.$loaded()}return r=a.$asArray(),r.$loaded()},c=["name","phone"],l=function(t,e){for(var n in c)if("undefined"==typeof t[c[n]])return!1;return t.$id===e?t.$save():a.$push(t)},u=function(t){return r.$id===t?(r.$remove(),r.$save()):void 0};return{get:s,save:l,remove:u}}]);